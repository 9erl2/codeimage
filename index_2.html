<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í€´ì¦ˆì‡¼</title>
  <!-- Teachable Machine ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
    <style>
    * {
        margin: 0;
        padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* ë©”ì¸ í™”ë©´ - ë²„íŠ¼ ì„ íƒ */
    #mainScreen {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 30px;
      background: #f0f0f0;
    }

    .difficulty-button {
      width: 300px;
      height: 80px;
      font-size: 24px;
      font-weight: bold;
      border: 3px solid #333;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #fff;
      color: #333;
    }

    .difficulty-button:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    /* í€´ì¦ˆ í™”ë©´ */
    .quiz-screen {
      width: 100%;
      height: 100%;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .quiz-screen.active {
      display: flex;
    }

    /* ë‚œì´ë„ í•˜ - gray ë°°ê²½ */
    #easyScreen {
      background: gray;
    }

    /* ë‚œì´ë„ ì¤‘ - ê¸°ë³¸ ë°°ê²½ */
    #mediumScreen {
      background: #e0e0e0;
    }

    /* ë‚œì´ë„ ìƒ - ê¸°ë³¸ ë°°ê²½ */
    #hardScreen {
      background: #d0d0d0;
    }

    .welcome-message {
      font-size: 36px;
      font-weight: bold;
      color: #fff;
      text-align: center;
      margin-bottom: 50px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    #mediumScreen .welcome-message,
    #hardScreen .welcome-message {
      color: #333;
      text-shadow: none;
    }

    .question-container {
      width: 80%;
      max-width: 800px;
      padding: 40px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      display: none;
      position: relative;
    } 

    .question-container.active {
      display: block;
    }

    .question-number {
      font-size: 18px;
      color: #666;
      margin-bottom: 20px;
    }

    .question-text {
      font-size: 28px;
      color: #333;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .answer-input {
      width: 100%;
      padding: 15px;
      font-size: 20px;
      border: 2px solid #333;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    /* ë‚œì´ë„ í•˜ - ì¼ë°˜ ì»¨í…Œì´ë„ˆ ì„¤ì • */
    #easyScreen .question-container {
      position: relative;
      width: 100%;
      padding: 20px;
    }

    #easyScreen .options-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .option-button {
      width: 100%;
      padding: 20px;
      font-size: 20px;
      background: #fff;
      color: #333;
      border: 3px solid #333;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    /* ë‚œì´ë„ í•˜ - ì¼ë°˜ ë ˆì´ì•„ì›ƒ */
    #easyScreen .option-button {
      position: relative;
      width: 100%;
      margin-bottom: 15px;
    }

    .option-button:hover {
      background: #f0f0f0;
      transform: translateX(5px);
    }

    /* ë‚œì´ë„ í•˜ì—ì„œëŠ” í˜¸ë²„ ì‹œ ì¼ë°˜ íš¨ê³¼ */
    #easyScreen .option-button:hover {
      background: #f0f0f0;
      transform: translateX(5px);
    }

    .option-button.selected {
      background: #333;
      color: #fff;
    }

    .submit-button {
      width: 100%;
      padding: 15px;
      font-size: 20px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }

    /* ë‚œì´ë„ í•˜: ì§ˆë¬¸ ë° ì œì¶œ ë²„íŠ¼ ê³ ì • ìœ„ì¹˜ */
    #easyScreen .question-number {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    #easyScreen .question-text {
      position: fixed;
      top: 130px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      max-width: 80%;
      text-align: center;
    }

    #easyScreen .submit-button {
      position: fixed;
      bottom: 280px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      z-index: 1000; /* ì›¹ìº ë³´ë‹¤ ë‚®ì§€ë§Œ ë‹µì§€ ë°•ìŠ¤ë³´ë‹¤ ë†’ìŒ */
      margin-top: 20px;
    }

    #easyScreen #resultMessage {
      position: fixed;
      bottom: 350px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      min-width: 300px;
    }

    .submit-button:hover {
      background: #555;
    }

    .submit-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid #333;
      border-radius: 5px;
      cursor: pointer;
    }

    .result-message {
      font-size: 24px;
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .result-message.correct {
      background: #4caf50;
      color: #fff;
      position: relative;
    }

    .result-message.incorrect {
      background: #f44336;
      color: #fff;
      position: relative;
    }

    /* ì •ë‹µ/ì˜¤ë‹µ ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
    .result-icon {
      display: inline-block;
      font-size: 48px;
      margin: 0 10px;
    }

    .checkmark-icon {
      animation: rotateIn 0.6s ease-out;
    }

    .x-icon {
      animation: fadeInScale 0.5s ease-out;
    }

    @keyframes rotateIn {
      0% {
        transform: rotate(-180deg) scale(0);
        opacity: 0;
      }
      50% {
        transform: rotate(10deg) scale(1.2);
      }
      100% {
        transform: rotate(0deg) scale(1);
        opacity: 1;
      }
    }

    @keyframes fadeInScale {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.3);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ê²°ê³¼ ë©”ì‹œì§€ ë°”ìš´ìŠ¤ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
    .result-message {
      animation: bounceIn 0.6s ease-out;
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.3) translateY(-100px);
        opacity: 0;
      }
      50% {
        transform: scale(1.05) translateY(10px);
      }
      70% {
        transform: scale(0.9) translateY(-5px);
      }
      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    /* í™”ë©´ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ (ì˜¤ë‹µ ì‹œ) */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    .quiz-screen.shake {
      animation: shake 0.5s ease-in-out;
    }

    /* ë°°ê²½ ê¹œë¹¡ì„ íš¨ê³¼ */
    @keyframes flash {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.6; }
    }

    .quiz-screen.flash-correct::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(76, 175, 80, 0.4);
      pointer-events: none;
      z-index: 1;
      animation: flash 0.3s ease-in-out;
    }

    .quiz-screen.flash-incorrect::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
        width: 100%;
        height: 100%;
      background: rgba(244, 67, 54, 0.4);
      pointer-events: none;
      z-index: 1;
      animation: flash 0.3s ease-in-out;
    }

    /* ë³„ íš¨ê³¼ */
  /*  .star {
      position: fixed;
      color: #ffd700;
      font-size: 30px;
      pointer-events: none;
      z-index: 1000;
      animation: starFall 1s ease-out forwards;
    } */

     @keyframes starFall {
      0% {
        transform: translateY(0) rotate(0deg) scale(0);
        opacity: 1;
      }
      50% {
        transform: translateY(-50px) rotate(180deg) scale(1.5);
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) rotate(360deg) scale(0);
        opacity: 0;
      }
    }

    /* í­ì£½ íš¨ê³¼ */
    .confetti {
      position: fixed;
      width: 5px;
      height: 5px;
      pointer-events: none;
      z-index: 1000;
      animation: confettiFall 4s ease-out forwards;
    }

    .confetti:nth-child(2n) { background: #00ff00; }
    .confetti:nth-child(3n) { background: #0000ff; }
    .confetti:nth-child(4n) { background: #ffff00; }
    .confetti:nth-child(5n) { background: #ff00ff; }

    @keyframes confettiFall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(500px, 800px) translateX(300px) rotate(720deg);
        opacity: 0;
      }
    }


    /* ì›¹ìº  ë° Teachable Machine ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .camera-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      height: 240px;
      border: 3px solid #333;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      z-index: 10000;
      pointer-events: auto;
    }

    #webcam {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1); /* ê±°ìš¸ ëª¨ë“œ */
    }

    .prediction-info {
      position: fixed;
      bottom: 270px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      z-index: 10001;
      min-width: 200px;
      pointer-events: none;
    }

    .prediction-item {
      margin: 5px 0;
      padding: 5px;
    }

    .prediction-item.highest {
      background: rgba(0, 200, 0, 0.3);
      font-weight: bold;
    }

    </style>
  </head>
  <body>
  <!-- ë©”ì¸ í™”ë©´ -->
  <div id="mainScreen">

    <button class="difficulty-button" onclick="startQuiz('easy')">ë‚œì´ë„ í•˜</button>
    <button class="difficulty-button" onclick="startQuiz('medium')">ë‚œì´ë„ ì¤‘</button>
    <button class="difficulty-button" onclick="startQuiz('hard')">ë‚œì´ë„ ìƒ</button>
  </div>

  <!-- ë‚œì´ë„ í•˜ í™”ë©´ -->
  <div id="easyScreen" class="quiz-screen">
    <button class="back-button" onclick="goBack()">â† ë’¤ë¡œê°€ê¸°</button>
    <div class="welcome-message">ì„œìš¸ì‹œë¦½ëŒ€ì— ê´€í•œ ì´ˆì„± í€´ì¦ˆì…ë‹ˆë‹¤.</div>
    <div id="easyQuestions" class="question-container"></div>
  </div>

  <!-- ë‚œì´ë„ ì¤‘ í™”ë©´ -->
  <div id="mediumScreen" class="quiz-screen">
    <button class="back-button" onclick="goBack()">â† ë’¤ë¡œê°€ê¸°</button>
    <div class="welcome-message">ì„œìš¸ì‹œë¦½ëŒ€ì— ê´€í•œ ë„Œì„¼ìŠ¤ í€´ì¦ˆì…ë‹ˆë‹¤.</div>
    <div id="mediumQuestions" class="question-container"></div>
  </div>

  <!-- ë‚œì´ë„ ìƒ í™”ë©´ -->
  <div id="hardScreen" class="quiz-screen">
    <button class="back-button" onclick="goBack()">â† ë’¤ë¡œê°€ê¸°</button>
    <div class="welcome-message">'ì´ì‹œë„¤'ì— ëŒ€í•œ ê°œì¸ì ì¸ í€´ì¦ˆì…ë‹ˆë‹¤</div>
    <div id="hardQuestions" class="question-container"></div>
  </div>

  <!-- ì›¹ìº  ë° ì˜ˆì¸¡ ì •ë³´ -->
  <div class="camera-container" id="cameraContainer" style="display: none;">
    <video id="webcam" autoplay playsinline></video>
  </div>
  <div class="prediction-info" id="predictionInfo" style="display: none;">
    <div>í¬ì¦ˆ ì¸ì‹ ê²°ê³¼:</div>
    <div id="predictions"></div>
  </div>


  <script>
    // Teachable Machine ê´€ë ¨ ë³€ìˆ˜
    let model = null;
    let webcam = null;
    let isPredicting = false;
    let lastPrediction = null;
    let predictionCount = 0;
    const PREDICTION_THRESHOLD = 0.5; // ì˜ˆì¸¡ ì‹ ë¢°ë„ ì„ê³„ê°’
    const PREDICTION_COUNT_THRESHOLD = 5; // ì—°ì† ì˜ˆì¸¡ íšŸìˆ˜

    // Teachable Machine ëª¨ë¸ ë¡œë“œ (Pose ëª¨ë¸)
    async function initTeachableMachine() {
      // ğŸ“Œ ëª¨ë¸ í´ë” ì´ë¦„ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”
      const folderName = "pose model";
      // URL ì¸ì½”ë”© ì ìš© (ê³µë°± ì²˜ë¦¬)
      const modelURL = `./${encodeURIComponent(folderName)}/model.json`;
      const metadataURL = `./${encodeURIComponent(folderName)}/metadata.json`;
      
      try {
        if (typeof tmPose === 'undefined') {
          throw new Error("tmPoseê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }
        console.log("ğŸ“ ëª¨ë¸ ë¡œë“œ ì‹œë„ ì¤‘...");
        console.log("   ëª¨ë¸ URL:", modelURL);
        console.log("   ë©”íƒ€ë°ì´í„° URL:", metadataURL);
        
        model = await tmPose.load(modelURL, metadataURL);
        console.log("âœ… Teachable Machine Pose ëª¨ë¸ ë¡œë“œ ì™„ë£Œ");
        console.log("   ëª¨ë¸ í´ë˜ìŠ¤ ìˆ˜:", model.getTotalClasses());
        console.log("   í´ë˜ìŠ¤ ëª©ë¡:", model.getClassLabels());
        console.log("   ëª¨ë¸ íƒ€ì…:", typeof model);
        
        await initWebcam();
      } catch (error) {
        console.error("ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨:", error);
        console.log("ğŸ’¡ ëª¨ë¸ íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        console.log("   í´ë” ì´ë¦„:", folderName);
        console.log("   ëª¨ë¸ ê²½ë¡œ:", modelURL);
        model = null;
      }
    }

    // ì›¹ìº  ì´ˆê¸°í™”
    async function initWebcam() {
      const video = document.getElementById('webcam');
      const container = document.getElementById('cameraContainer');
      
      if (!video || !container) {
        console.error("ì›¹ìº  ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      
      if (video.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }
      
      isPredicting = false;
      webcam = null;
      
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: { 
            width: { ideal: 640 }, 
            height: { ideal: 480 },
            facingMode: 'user'
          } 
        });
        
        video.srcObject = stream;
        
        await new Promise((resolve, reject) => {
          const timeout = setTimeout(() => {
            reject(new Error("ë¹„ë””ì˜¤ ë¡œë“œ íƒ€ì„ì•„ì›ƒ"));
          }, 5000);
          
          video.onloadedmetadata = () => {
            clearTimeout(timeout);
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            webcam = { video: video, canvas: canvas };
            
            container.style.display = 'block';
            const predictionInfo = document.getElementById('predictionInfo');
            if (predictionInfo) {
              predictionInfo.style.display = 'block';
            }
            
            resolve();
          };
          
          if (video.readyState >= 2) {
            clearTimeout(timeout);
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            webcam = { video: video, canvas: canvas };
            container.style.display = 'block';
            const predictionInfo = document.getElementById('predictionInfo');
            if (predictionInfo) {
              predictionInfo.style.display = 'block';
            }
            resolve();
          }
        });
        
        if (model) {
          console.log("ğŸ¬ ì˜ˆì¸¡ ì‹œì‘");
          isPredicting = true;
          predict();
        } else {
          console.warn("âš ï¸ ëª¨ë¸ì´ ë¡œë“œë˜ì§€ ì•Šì•„ ì˜ˆì¸¡ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      } catch (error) {
        console.error("ì›¹ìº  ì ‘ê·¼ ì‹¤íŒ¨:", error);
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          alert("ì›¹ìº  ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
        } else if (error.name === 'NotFoundError') {
          alert("ì›¹ìº ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        } else {
          alert("ì›¹ìº  ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        }
      }
    }

    // ì˜ˆì¸¡ ë£¨í”„
    async function predict() {
      if (!model || !webcam || !isPredicting) {
        if (!model) console.warn("âš ï¸ ëª¨ë¸ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        if (!webcam) console.warn("âš ï¸ ì›¹ìº ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        if (!isPredicting) console.warn("âš ï¸ ì˜ˆì¸¡ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
        return;
      }

      const ctx = webcam.canvas.getContext('2d');
      ctx.drawImage(webcam.video, 0, 0, webcam.canvas.width, webcam.canvas.height);
      
      try {
        if (!webcam.video || webcam.video.readyState < 2) {
          requestAnimationFrame(() => predict());
          return;
        }
        
        // í¬ì¦ˆ ì¶”ì •
        const pose = await model.estimatePose(webcam.video);
        
        // í¬ì¦ˆê°€ ì—†ì–´ë„ ì˜ˆì¸¡ ì‹œë„ (Teachable Machine PoseëŠ” í¬ì¦ˆê°€ ì—†ì–´ë„ ë¶„ë¥˜ ê°€ëŠ¥)
        // í•˜ì§€ë§Œ í‚¤í¬ì¸íŠ¸ê°€ ìˆìœ¼ë©´ ë” ì •í™•í•¨
        if (pose && pose.keypoints) {
          const keypoints = pose.keypoints.filter(kp => kp.score > 0.3);
          if (keypoints.length > 0 && Math.random() < 0.01) {
            console.log(`âœ… í‚¤í¬ì¸íŠ¸ ê°ì§€: ${keypoints.length}ê°œ`);
          }
        }
        
        // í¬ì¦ˆ ê°ì²´ë¡œ ì˜ˆì¸¡ (í¬ì¦ˆê°€ nullì´ì–´ë„ ê°€ëŠ¥)
        const prediction = await model.predict(pose);
        
        if (prediction && prediction.length > 0) {
          // ë””ë²„ê¹…: ì˜ˆì¸¡ ê²°ê³¼ í™•ì¸ (ê°€ë”ë§Œ ì¶œë ¥)
          if (Math.random() < 0.05) {
            const maxPred = prediction.reduce((max, p) => p.probability > max.probability ? p : max, prediction[0]);
            console.log(`ğŸ“Š ì˜ˆì¸¡: ${maxPred.className} (${(maxPred.probability * 100).toFixed(1)}%)`);
          }
          
          updatePredictionDisplay(prediction);
          handlePosePrediction(prediction);
        } else {
          if (Math.random() < 0.01) {
            console.warn("âš ï¸ ì˜ˆì¸¡ ê²°ê³¼ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
          }
          const predictionsDiv = document.getElementById('predictions');
          if (predictionsDiv) {
            predictionsDiv.innerHTML = '<div style="color: #ff6b6b;">ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
          }
        }
      } catch (error) {
        console.error("âŒ ì˜ˆì¸¡ ì˜¤ë¥˜:", error);
        console.error("ì—ëŸ¬ ìƒì„¸:", error.message);
        if (error.stack) {
          console.error("ìŠ¤íƒ:", error.stack);
        }
      }
      
      requestAnimationFrame(() => predict());
    }

    // ì˜ˆì¸¡ ê²°ê³¼ í‘œì‹œ
    function updatePredictionDisplay(prediction) {
      const predictionsDiv = document.getElementById('predictions');
      if (!predictionsDiv) return;

      let html = '';
      let highestClass = '';
      let highestProb = 0;

      prediction.forEach((pred) => {
        const prob = (pred.probability * 100).toFixed(1);
        if (pred.probability > highestProb) {
          highestProb = pred.probability;
          highestClass = pred.className;
        }
        html += `<div class="prediction-item ${pred.probability === highestProb ? 'highest' : ''}">
          ${pred.className}: ${prob}%
        </div>`;
      });

      predictionsDiv.innerHTML = html;
      lastPrediction = { class: highestClass, prob: highestProb };
    }

    // í¬ì¦ˆ ì¸ì‹ ê²°ê³¼ë¡œ ë‹µë³€ ì„ íƒ
    function handlePosePrediction(prediction) {
      if (!prediction || prediction.length === 0) return;

      let highestClass = '';
      let highestProb = 0;
      
      prediction.forEach(pred => {
        if (pred.probability > highestProb) {
          highestProb = pred.probability;
          highestClass = pred.className;
        }
      });

      // ë””ë²„ê¹…: ì˜ˆì¸¡ ê²°ê³¼ ì¶œë ¥ (ê°€ë”ë§Œ)
      if (Math.random() < 0.1) {
        console.log(`ğŸ¯ ìµœê³  ì˜ˆì¸¡: ${highestClass} (${(highestProb * 100).toFixed(1)}%), ì„ê³„ê°’: ${(PREDICTION_THRESHOLD * 100).toFixed(1)}%, ì—°ì†: ${predictionCount}/${PREDICTION_COUNT_THRESHOLD}`);
      }

      if (highestProb >= PREDICTION_THRESHOLD) {
        if (lastPrediction && lastPrediction.class === highestClass) {
          predictionCount++;
          
          if (predictionCount >= PREDICTION_COUNT_THRESHOLD) {
            console.log(`âœ… ë‹µ ì„ íƒ ì‹¤í–‰: ${highestClass} (${(highestProb * 100).toFixed(1)}%)`);
            selectAnswerByPose(highestClass);
            predictionCount = 0;
          }
        } else {
          predictionCount = 1;
        }
      } else {
        predictionCount = 0;
      }
      
      // lastPrediction ì—…ë°ì´íŠ¸
      lastPrediction = { class: highestClass, prob: highestProb };
    }

    // í¬ì¦ˆë¡œ ë‹µë³€ ì„ íƒ
    function selectAnswerByPose(poseClass) {
      const optionNumber = parseInt(poseClass.replace(/[^0-9]/g, ''));
      
      if (optionNumber >= 1 && optionNumber <= 4) {
        const optionIndex = optionNumber - 1;
        selectOption(optionIndex);
        console.log(`í¬ì¦ˆë¡œ ${optionNumber}ë²ˆ ì„ íƒë¨: ${poseClass}`);
      }
    }

    // ì§ˆë¬¸ ë°ì´í„° - ì—¬ê¸°ì— ì§ˆë¬¸ì„ ì¶”ê°€í•˜ì„¸ìš”!
    // ê°ê´€ì‹ í˜•ì‹: { question: "ì§ˆë¬¸", answer: "ì •ë‹µ", options: ["ì„ íƒì§€1", "ì„ íƒì§€2", "ì„ íƒì§€3", "ì„ íƒì§€4"] }
    const quizData = {
      easy: [
        { 
          question: "ã……ã…‡ã……ã„¹ã„·ã…ã„±", 
          answer: "1ë²ˆ: ì„œìš¸ì‹œë¦½ëŒ€í•™êµ",
          options: ["1ë²ˆ: ì„œìš¸ì‹œë¦½ëŒ€í•™êµ", "2ë²ˆ: ì„œìš¸ì‚¬ë‘ëŒ€í•™êµ", "3ë²ˆ: ì„œìš¸ì‹œëŸ¬ëŒ€í•™êµ", "4ë²ˆ: ì‹œë¦½ì‚¬ë‘ëŒ€í•™êµ"]
        },
        { 
          question: "ã…‡ã……ã…Šã…‡ã„·", 
          answer: "2ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€",
          options: ["1ë²ˆ: ì˜ˆìˆ ì¹˜ì˜ëŒ€ ", "2ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€", "3ë²ˆ: ì˜ˆìˆ ì´ˆìƒëŒ€", "4ë²ˆ: ìš”ì–‘ì²´ìœ¡ëŒ€"]
        },
        { 
          question: "ã…‡ã…‡ã…‡ã…‡ã……ã„¹ã…", 
          answer: "2ë²ˆ: ì—ì´ì•„ì´ì‚¬ë‘í•´",
          options: ["1ë²ˆ: ì—ì´ì•„ì´ì‹œë¡œí•´", "2ë²ˆ: ì—ì´ì•„ì´ì‚¬ë‘í•´", "3ë²ˆ: ì—ì´ì•„ì´ì†Œë‘í•´", "4ë²ˆ: ì—ì´ì•„ì´ì†Œë¼í•´"]
        },
        { 
          question: "ã…ã„´ã…", 
          answer: "4ë²ˆ: í•˜ëŠ˜ëª»",
          options: ["1ë²ˆ: í•˜ëŠ˜ë§›", "2ë²ˆ: í•˜ëŠ˜ë­", "3ë²ˆ: í•˜ë‚˜ë§Œ", "4ë²ˆ: í•˜ëŠ˜ëª»"]
        },
        { 
          question: "ã„·ã„·ã…ã„±", 
          answer: "3ë²ˆ: ë™ëŒ€ë¬¸êµ¬",
          options: ["1ë²ˆ: ë™ëŒ€ë¬¸ë™", "2ë²ˆ: ë™ëŒ€ë¬¸ì‹œ", "3ë²ˆ: ë™ëŒ€ë¬¸êµ¬", "4ë²ˆ: ë™ëŒ€ë¬¸ë©´"]
        },
        { 
          question: "ã…‡ã……ã…Šã…‡ã„·ã…", 
          answer: "2ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€í•™",
          options: ["1ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€í•™ì›", "2ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€í•™", "3ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€í•™êµ", "4ë²ˆ: ì˜ˆìˆ ì²´ìœ¡ëŒ€í•™ë¶€"]
        },
        { 
          question: "UOS", 
          answer: "1ë²ˆ: U, UOR STAR",
          options: ["1ë²ˆ: U, UOR STAR", "2ë²ˆ: U, UOR SEOUL", "3ë²ˆ: U, UOR START", "4ë²ˆ: U, UOR SOUND"]
        },
        { 
          question: "ã…", 
          answer: "1ë²ˆ: ë§¤",
          options: ["1ë²ˆ: ë§¤", "2ë²ˆ: ë…ìˆ˜ë¦¬", "3ë²ˆ: ë¹„ë‘˜ê¸°", "4ë²ˆ: ì°¸ìƒˆ"]
        },
        { 
          question: "ã…‡ã…ã…ˆ", 
          answer: "3ë²ˆ: ì¸í–¥ì œ",
          options: ["1ë²ˆ: ì€í•˜ì§€", "2ë²ˆ: ì€í•˜ì œ", "3ë²ˆ: ì¸í–¥ì œ", "4ë²ˆ: ì•ˆí–¥ì œ"]
        },
        { 
          question: "ã„·ã……ã…ã„±ã……ã…‡ã„·", 
          answer: "2ë²ˆ: ë„ì‹œì™€í•¨ê»˜ì„±ì¥í•˜ëŠ”ëŒ€í•™",
          options: ["1ë²ˆ: ë„ì‹œì™€í•¨ê»˜ë°œì „í•˜ëŠ”ëŒ€í•™", "2ë²ˆ: ë„ì‹œì™€í•¨ê»˜ì„±ì¥í•˜ëŠ”ëŒ€í•™", "3ë²ˆ: ë„ì‹œì™€í•¨ê»˜ì„±ì¥í•˜ëŠ”í•™êµ", "4ë²ˆ: ë„ì‹œì™€í•¨ê»˜ì„±ì¥í•˜ëŠ”ê¸°ê´€"]
        },
        { 
          question: "ã…ã„¹ã……", 
          answer: "4ë²ˆ: íŒŒë€ìƒ‰",
          options: ["1ë²ˆ: ë¹¨ê°„ìƒ‰", "2ë²ˆ: ì´ˆë¡ìƒ‰", "3ë²ˆ: ë…¸ë€ìƒ‰", "4ë²ˆ: íŒŒë€ìƒ‰"]
        },
      ],
      medium: [
       
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€í•™êµì˜ ê³µì‹ ì•½ì¹­ì€?", 
          answer: "1ë²ˆ: UOS",
          options: ["1ë²ˆ: UOS", "2ë²ˆ: SNU", "3ë²ˆ: YU", "4ë²ˆ: KU"]
        },
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€ í•™ìƒì„ ë­ë¼ê³  ë¶€ë¥¼ê¹Œìš”?", 
          answer: "4ë²ˆ: ì‹œëŒ€ìƒ",
          options: ["1ë²ˆ: ì‹œëŒ€ì˜ë³„", "2ë²ˆ: ì‹œëŒ€ë¬¼", "3ë²ˆ: ì‹œëŒ€ì‚¬", "4ë²ˆ: ì‹œëŒ€ìƒ"]
        },
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€í•™êµì˜ êµ¬ëŠ”?", 
          answer: "3ë²ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë™ëŒ€ë¬¸êµ¬",
          options: ["1ë²ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬", "2ë²ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬", "3ë²ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë™ëŒ€ë¬¸êµ¬", "4ë²ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬"]
        },
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€ì˜ ìœ ì¼í•œ ëŒ„ìŠ¤ ë™ì•„ë¦¬ ì´ë¦„ì€?", 
          answer: "3ë²ˆ: RAH",
          options: ["1ë²ˆ: UDG", "2ë²ˆ: UOD", "3ë²ˆ: RAH", "4ë²ˆ: URH"]
        },
        { 
          question: "ê±´ê³µì´ëŠ” ëˆ„êµ¬ì¼ê¹Œ?", 
          answer: "1ë²ˆ: ê±´ê³µê´€ì— ì‚¬ëŠ” ê³ ì–‘ì´",
          options: ["1ë²ˆ: ê±´ê³µê´€ì— ì‚¬ëŠ” ê³ ì–‘ì´", "2ë²ˆ: ê±´ê³µê´€ì— ì‚¬ëŠ” ê³ ìŠ´ë„ì¹˜", "3ë²ˆ: ê±´ê³µê´€ì— ìì£¼ ë³´ì´ëŠ” ê³µ", "4ë²ˆ: ê±´ì¶•ê³µí•™ê´€ì„ ëœ»í•¨"]
        },
        { 
          question: "ì´ë£¨ë§¤ëŠ” ê·€ì—½ë‚˜ìš”?", 
          answer: "3ë²ˆ: ë„¤ë‹ˆìš”",
          options: ["1ë²ˆ: ë„¤", "2ë²ˆ: ì•„ë‹ˆìš”", "3ë²ˆ: ë„¤ë‹ˆìš”", "4ë²ˆ: ì•„ë‹ˆì˜ˆ"]
        },
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€í•™êµì˜ ëŒ€í‘œ ìƒ‰ìƒì€?", 
          answer: "3ë²ˆ: íŒŒë€ìƒ‰",
          options: ["1ë²ˆ: ë¹¨ê°„ìƒ‰", "2ë²ˆ: ì´ˆë¡ìƒ‰", "3ë²ˆ: íŒŒë€ìƒ‰", "4ë²ˆ: ë…¸ë€ìƒ‰"]
        },
        { 
          question: "ì´ë£¨ë§¤ëŠ” í•­ìƒ ì›ƒê³  ìˆì„ê¹Œìš”?", 
          answer: "3ë²ˆ: ì•„ë§ˆë„??",
          options: ["1ë²ˆ: í ,,", "2ë²ˆ: ê¸€ì„ìš”,,", "3ë²ˆ: ì•„ë§ˆë„??", "4ë²ˆ: ë„¤ë‹ˆìš”!"]
        },
        { 
          question: "ê±´ê³µì´ëŠ” ë¬´ìŠ¨ ìƒ‰?", 
          answer: "1ë²ˆ: ì£¼í™©ìƒ‰",
          options: ["1ë²ˆ: ì£¼í™©ìƒ‰", "2ë²ˆ: ê²€ì€ìƒ‰", "3ë²ˆ: ë¹¨ê°„ìƒ‰", "4ë²ˆ: í°ìƒ‰"]
        },
        { 
          question: "ì„œìš¸ì‹œë¦½ëŒ€ì— ì—†ëŠ” ë™ì•„ë¦¬ëŠ”?", 
          answer: "3ë²ˆ: ìŠ¤ì¼€ì´íŠ¸ ë™ì•„ë¦¬",
          options: ["1ë²ˆ: ìŠ¤ì¿ ë²„ ë‹¤ì´ë¹™ ë™ì•„ë¦¬", "2ë²ˆ: ìì „ê±° ë™ì•„ë¦¬", "3ë²ˆ: ìŠ¤ì¼€ì´íŠ¸ ë™ì•„ë¦¬", "4ë²ˆ: ì•¼ìƒì¡°ë¥˜ ì—°êµ¬ ë™ì•„ë¦¬"]
        },
      ],
      hard: [
      { 
          question: "ì´ì‹œë„¤ì˜ í‚¤ëŠ” ëª‡ cmì¼ê¹Œìš”?", 
          answer: "3ë²ˆ: 168cm",
          options: ["1ë²ˆ: 166cm", "2ë²ˆ: 167cm", "3ë²ˆ: 168cm", "4ë²ˆ: 170cm"]
        },
        { 
          question: "ì´ì‹œë„¤ì˜ ì œì¼ ì¢‹ì•„í•˜ëŠ” ìŠ¤ë¬´ë””ëŠ”?", 
          answer: "1ë²ˆ: ë§ê³  ìŠ¤ë¬´ë””",
          options: ["1ë²ˆ: ë§ê³  ìŠ¤ë¬´ë””", "2ë²ˆ: ìš”ê±°íŠ¸ ìŠ¤ë¬´ë””", "3ë²ˆ: í‚¤ìœ„ ìŠ¤ë¬´ë””", "4ë²ˆ: ë”¸ê¸° ìŠ¤ë¬´ë””"]
        },
        { 
          question: "ì´ì‹œë„¤ì˜ ì¢‹ì•„í•˜ëŠ” ì»¬ëŸ¬ëŠ”?", 
          answer: "4ë²ˆ: ë³´ë¼",
          options: ["1ë²ˆ: ê²€ì •", "2ë²ˆ: í•‘í¬", "3ë²ˆ: ë¸”ë£¨", "4ë²ˆ: ë³´ë¼"]
        },
        { 
          question: "ì´ì‹œë„¤ì˜ ì¢‹ì•„í•  ê²ƒ ê°™ì€ ì·¨ë¯¸ëŠ”?", 
          answer: "1ë²ˆ: ìì „ê±° íƒ€ê¸°",
          options: ["1ë²ˆ: ìì „ê±° íƒ€ê¸°", "2ë²ˆ: ë…ì„œ í•˜ê¸°", "3ë²ˆ: ì˜í™”ê´€ ê°€ê¸°", "4ë²ˆ: ê²Œì„ í•˜ê¸°"]
        },
        { 
          question: "ì´ì‹œë„¤ì˜ ì˜¤ëŠ˜ ëª‡ì‹œê°„ ì¤ì„ê¹Œìš”?", 
          answer: "4ë²ˆ: ",
          options: ["1ë²ˆ: 6ì‹œê°„", "2ë²ˆ: 9ì‹œê°„", "3ë²ˆ: 4ì‹œê°„", "4ë²ˆ: 2ì‹œê°„"]
        },
      ]
    };

    let currentDifficulty = null;
    let currentQuestionIndex = 0;
    let currentQuestions = [];

    // í€´ì¦ˆ ì‹œì‘
    function startQuiz(difficulty) {
      currentDifficulty = difficulty;
      currentQuestionIndex = 0;
      currentQuestions = quizData[difficulty];

      // ë©”ì¸ í™”ë©´ ìˆ¨ê¸°ê¸°
      document.getElementById('mainScreen').style.display = 'none';

      // í•´ë‹¹ ë‚œì´ë„ í™”ë©´ í‘œì‹œ
      const screenId = difficulty + 'Screen';
      document.getElementById(screenId).classList.add('active');

      // Teachable Machine ì´ˆê¸°í™”
      if (!model) {
        initTeachableMachine();
      } else {
        initWebcam();
      }

      // ì§ˆë¬¸ í‘œì‹œ
      showQuestion();
    }

    // ì§ˆë¬¸ í‘œì‹œ
    function showQuestion() {
      if (currentQuestionIndex >= currentQuestions.length) {
        // ëª¨ë“  ì§ˆë¬¸ ì™„ë£Œ
        showCompletion();
        return;
      }

      const question = currentQuestions[currentQuestionIndex];
      const containerId = currentDifficulty + 'Questions';
      const container = document.getElementById(containerId);

      // ê°ê´€ì‹ ì„ íƒì§€ ìƒì„±
      let optionsHTML = '';
      if (question.options && question.options.length > 0) {
        optionsHTML = '<div class="options-container">';
        question.options.forEach((option, index) => {
          optionsHTML += `
            <button class="option-button" id="option${index}" style="cursor: default; pointer-events: none;">
              ${option}
            </button>
          `;
        });
        optionsHTML += '</div>';
      }

      container.innerHTML = `
        <div class="question-number">ì§ˆë¬¸ ${currentQuestionIndex + 1} / ${currentQuestions.length}</div>
        <div class="question-text">${question.question}</div>
        ${optionsHTML}
        <button class="submit-button" id="submitBtn" onclick="checkAnswer()" disabled>ë‹µë³€ ì œì¶œ</button>
        <div id="resultMessage"></div>
      `;

      container.classList.add('active');

      // ë‚œì´ë„ ìƒ: ë‹µì§€ ë°•ìŠ¤ë“¤ì„ ëœë¤ ìœ„ì¹˜ì— ë°°ì¹˜í•˜ê³  ì›€ì§ì´ê²Œ í•¨
      if (currentDifficulty === 'hard') {
        setTimeout(() => {
          initRandomButtonMovement(container);
        }, 100);
      }
    }

    // ë‚œì´ë„ ìƒ: ëœë¤ ì›€ì§ì„ ì´ˆê¸°í™” (ì›¹ìº  ì˜ì—­ í”¼í•˜ê¸°)
    let movingButtons = [];
    let animationFrameId = null;

    function initRandomButtonMovement(container) {
      // ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
      movingButtons = [];

      const buttons = container.querySelectorAll('.option-button');
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      const buttonWidth = 300;
      const buttonHeight = 80;
      
      // ì›¹ìº  ì˜ì—­ (ìš°ì¸¡ í•˜ë‹¨) ì œì™¸
      const webcamArea = {
        right: screenWidth - 20, // ìš°ì¸¡ ì—¬ë°±
        bottom: 20, // í•˜ë‹¨ ì—¬ë°±
        width: 320, // ì›¹ìº  ë„ˆë¹„
        height: 240 + 50 // ì›¹ìº  ë†’ì´ + ì˜ˆì¸¡ ì •ë³´ ì˜ì—­
      };

      buttons.forEach((btn, index) => {
        let centerX, centerY;
        let attempts = 0;
        
        // ì›¹ìº  ì˜ì—­ì„ í”¼í•˜ëŠ” ëœë¤ ìœ„ì¹˜ ìƒì„±
        do {
          centerX = Math.random() * (screenWidth - buttonWidth);
          centerY = 100 + Math.random() * (screenHeight - 300);
          attempts++;
        } while (
          attempts < 50 && // ìµœëŒ€ 50ë²ˆ ì‹œë„
          centerX + buttonWidth > webcamArea.right - webcamArea.width &&
          centerY + buttonHeight > screenHeight - webcamArea.height
        );
        
        btn.style.left = centerX + 'px';
        btn.style.top = centerY + 'px';
        
        // ëœë¤ ì†ë„ì™€ ë°©í–¥ (ê° ë²„íŠ¼ë§ˆë‹¤ ë‹¤ë¥¸ ì†ë„)
        const speedX = (Math.random() - 0.5) * 2; // -1 ~ 1
        const speedY = (Math.random() - 0.5) * 2; // -1 ~ 1
        const rotationSpeed = (Math.random() - 0.5) * 2; // íšŒì „ ì†ë„
        
        // ê° ë²„íŠ¼ì˜ ìƒíƒœ ì €ì¥
        movingButtons.push({
          element: btn,
          x: centerX,
          y: centerY,
          speedX: speedX,
          speedY: speedY,
          rotation: 0,
          rotationSpeed: rotationSpeed,
          width: buttonWidth,
          height: buttonHeight
        });
      });

      // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      animateRandomButtonMovement();
    }

    // ëœë¤ ì›€ì§ì„ ì• ë‹ˆë©”ì´ì…˜ (ì›¹ìº  ì˜ì—­ í”¼í•˜ê¸°)
    function animateRandomButtonMovement() {
      if (movingButtons.length === 0) return;

      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      const webcamArea = {
        right: screenWidth - 20,
        bottom: 20,
        width: 320,
        height: 240 + 50
      };

      movingButtons.forEach(button => {
        // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        button.x += button.speedX;
        button.y += button.speedY;
        button.rotation += button.rotationSpeed;

        // í™”ë©´ ê²½ê³„ì—ì„œ íŠ•ê¸°ê¸°
        if (button.x <= 0 || button.x >= screenWidth - button.width) {
          button.speedX *= -1;
          button.x = Math.max(0, Math.min(screenWidth - button.width, button.x));
        }
        if (button.y <= 100 || button.y >= screenHeight - button.height - 100) {
          button.speedY *= -1;
          button.y = Math.max(100, Math.min(screenHeight - button.height - 100, button.y));
        }

        // ì›¹ìº  ì˜ì—­ê³¼ ì¶©ëŒ ë°©ì§€
        const buttonRight = button.x + button.width;
        const buttonBottom = button.y + button.height;
        const webcamLeft = webcamArea.right - webcamArea.width;
        const webcamTop = screenHeight - webcamArea.height;

        if (buttonRight > webcamLeft && button.x < webcamArea.right && 
            buttonBottom > webcamTop && button.y < screenHeight - webcamArea.bottom) {
          // ì›¹ìº  ì˜ì—­ì— ë“¤ì–´ê°€ë©´ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ íŠ•ê¸°ê¸°
          if (button.x < webcamLeft) {
            button.speedX = -Math.abs(button.speedX);
          } else {
            button.speedX = Math.abs(button.speedX);
          }
          if (button.y < webcamTop) {
            button.speedY = -Math.abs(button.speedY);
          } else {
            button.speedY = Math.abs(button.speedY);
          }
        }

        // ìœ„ì¹˜ì™€ íšŒì „ ì ìš©
        button.element.style.left = button.x + 'px';
        button.element.style.top = button.y + 'px';
        button.element.style.transform = `rotate(${button.rotation}deg)`;
      });

      // ë‹¤ìŒ í”„ë ˆì„ ìš”ì²­
      animationFrameId = requestAnimationFrame(animateRandomButtonMovement);
    }

    // ì„ íƒì§€ ì„ íƒ
    let selectedOptionIndex = -1;
    function selectOption(index) {
      // ì´ì „ ì„ íƒ í•´ì œ
      document.querySelectorAll('.option-button').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // í˜„ì¬ ì„ íƒ í‘œì‹œ
      const selectedBtn = document.getElementById('option' + index);
      selectedBtn.classList.add('selected');
      selectedOptionIndex = index;
      
      // ì œì¶œ ë²„íŠ¼ í™œì„±í™”
      document.getElementById('submitBtn').disabled = false;
    }

    // ë³„ íš¨ê³¼ ìƒì„±
    function createStars(x, y, count = 15) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.textContent = 'â­';
        star.style.left = (x + (Math.random() - 0.5) * 200) + 'px';
        star.style.top = (y + (Math.random() - 0.5) * 200) + 'px';
        star.style.animationDelay = (Math.random() * 0.3) + 's';
        document.body.appendChild(star);
        
        setTimeout(() => star.remove(), 1000);
      }
    }

    // í­ì£½ íš¨ê³¼ ìƒì„±
    function createConfetti(x, y, count = 30) {
      for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = (x + (Math.random() - 0.5) * 300) + 'px';
        confetti.style.top = (y + (Math.random() - 0.5) * 300) + 'px';
        confetti.style.animationDelay = (Math.random() * 0.5) + 's';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 1500);
      }
    }

    // ë°°ê²½ ê¹œë¹¡ì„ íš¨ê³¼
    function flashBackground(isCorrect) {
      const screenId = currentDifficulty + 'Screen';
      const screen = document.getElementById(screenId);
      
      if (isCorrect) {
        screen.classList.add('flash-correct');
      } else {
        screen.classList.add('flash-incorrect');
      }
      
      setTimeout(() => {
        screen.classList.remove('flash-correct', 'flash-incorrect');
      }, 300);
    }

    // í™”ë©´ í”ë“¤ë¦¼ íš¨ê³¼
    function shakeScreen() {
      const screenId = currentDifficulty + 'Screen';
      const screen = document.getElementById(screenId);
      screen.classList.add('shake');
      
      setTimeout(() => {
        screen.classList.remove('shake');
      }, 500);
    }

    // ë‹µë³€ í™•ì¸
    function checkAnswer() {
      if (selectedOptionIndex === -1) {
        alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const question = currentQuestions[currentQuestionIndex];
      const userAnswer = question.options[selectedOptionIndex];
      const correctAnswer = question.answer;
      const resultDiv = document.getElementById('resultMessage');

      // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.getElementById('submitBtn').disabled = true;

      // ê²°ê³¼ ë©”ì‹œì§€ ìœ„ì¹˜ ê³„ì‚° (í™”ë©´ ì¤‘ì•™)
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      const centerX = screenWidth / 2;
      const centerY = screenHeight / 2;

      if (userAnswer === correctAnswer) {
        // ì •ë‹µ ì²˜ë¦¬
        resultDiv.innerHTML = '<div class="result-message correct"><span class="result-icon checkmark-icon">âœ“</span>ì •ë‹µì…ë‹ˆë‹¤!</div>';
        
        // ë°°ê²½ ê¹œë¹¡ì„ (ì´ˆë¡ìƒ‰)
        flashBackground(true);
        
        // ë³„ íš¨ê³¼
        createStars(centerX, centerY, 20);
        
        // í­ì£½ íš¨ê³¼
        createConfetti(centerX, centerY, 40);
        
        setTimeout(() => {
          selectedOptionIndex = -1;
          currentQuestionIndex++;
          showQuestion();
        }, 2000);
      } else {
        // ì˜¤ë‹µ ì²˜ë¦¬
        resultDiv.innerHTML = `<div class="result-message incorrect"><span class="result-icon x-icon">âœ—</span>í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µ: ${correctAnswer}</div>`;
        
        // ë°°ê²½ ê¹œë¹¡ì„ (ë¹¨ê°„ìƒ‰)
        flashBackground(false);
        
        // í™”ë©´ í”ë“¤ë¦¼
        shakeScreen();
        
        setTimeout(() => {
          selectedOptionIndex = -1;
          currentQuestionIndex++;
          showQuestion();
        }, 2500);
      }
    }

    // ì™„ë£Œ í™”ë©´
    function showCompletion() {
      const containerId = currentDifficulty + 'Questions';
      const container = document.getElementById(containerId);

      container.innerHTML = `
        <div class="question-text" style="text-align: center;">
          ëª¨ë“  ì§ˆë¬¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!<br>
          ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!
        </div>
        <button class="submit-button" onclick="goBack()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      `;
    }

    // ë’¤ë¡œê°€ê¸°
    function goBack() {
      // ëª¨ë“  í€´ì¦ˆ í™”ë©´ ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.quiz-screen').forEach(screen => {
        screen.classList.remove('active');
      });

      // ë©”ì¸ í™”ë©´ í‘œì‹œ
      document.getElementById('mainScreen').style.display = 'flex';

      // ì›¹ìº  ìˆ¨ê¸°ê¸° ë° ì˜ˆì¸¡ ì¤‘ì§€
      isPredicting = false;
      document.getElementById('cameraContainer').style.display = 'none';
      document.getElementById('predictionInfo').style.display = 'none';
      
      // ì›¹ìº  ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
      const video = document.getElementById('webcam');
      if (video && video.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }
      webcam = null;

      // ë‚œì´ë„ í•˜ ëœë¤ ì›€ì§ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
      }
      movingButtons = [];

      // ìƒíƒœ ì´ˆê¸°í™”
      currentDifficulty = null;
      currentQuestionIndex = 0;
      currentQuestions = [];
      selectedOptionIndex = -1;
      predictionCount = 0;
      lastPrediction = null;
    }

    // ì§ˆë¬¸ ì¶”ê°€ í•¨ìˆ˜ (ì½˜ì†”ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
    // ê°ê´€ì‹ í˜•ì‹: addQuestion('easy', 'ì§ˆë¬¸', 'ì •ë‹µ', ['ì„ íƒì§€1', 'ì„ íƒì§€2', 'ì„ íƒì§€3', 'ì„ íƒì§€4'])
    function addQuestion(difficulty, question, answer, options) {
      if (!quizData[difficulty]) {
        console.error('ì˜ëª»ëœ ë‚œì´ë„ì…ë‹ˆë‹¤.');
        return;
      }
      if (!options || options.length === 0) {
        console.error('ì„ íƒì§€(options)ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.');
        return;
      }
      quizData[difficulty].push({ question, answer, options });
      console.log(`${difficulty} ë‚œì´ë„ì— ì§ˆë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
  </script>
  </body>
</html>
